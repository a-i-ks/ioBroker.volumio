{
  "version": 3,
  "sources": ["../../src/lib/websocketVolumioClient.ts"],
  "sourcesContent": ["/**\n * WebSocket implementation of Volumio Client\n *\n * This client communicates with Volumio using Socket.IO WebSocket connections.\n * Real-time state updates are received via 'pushState' events.\n */\n\nimport type { Socket } from \"socket.io-client\";\nimport { io } from \"socket.io-client\";\nimport type {\n  IVolumioClient,\n  VolumioState,\n  VolumioSystemInfo,\n  StateChangeCallback,\n  ConnectionStateCallback,\n} from \"./volumioClient\";\n\nexport interface WebSocketClientConfig {\n  host: string;\n  port: number;\n  reconnectAttempts?: number; // Number of reconnection attempts (default: 5)\n  reconnectDelay?: number; // Delay between reconnection attempts in ms (default: 2000)\n}\n\nexport class WebSocketVolumioClient implements IVolumioClient {\n  private config: WebSocketClientConfig;\n  private socket?: Socket;\n  private connected: boolean = false;\n  private stateChangeCallbacks: StateChangeCallback[] = [];\n  private connectionChangeCallbacks: ConnectionStateCallback[] = [];\n\n  constructor(config: WebSocketClientConfig) {\n    this.config = {\n      ...config,\n      reconnectAttempts: config.reconnectAttempts || 5,\n      reconnectDelay: config.reconnectDelay || 2000,\n    };\n  }\n\n  async connect(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const url = `http://${this.config.host}:${this.config.port}`;\n\n      this.socket = io(url, {\n        reconnection: true,\n        reconnectionAttempts: this.config.reconnectAttempts,\n        reconnectionDelay: this.config.reconnectDelay,\n        timeout: 10000,\n      });\n\n      this.socket.on(\"connect\", () => {\n        this.connected = true;\n        this.notifyConnectionChange(true);\n        resolve();\n      });\n\n      this.socket.on(\"disconnect\", () => {\n        this.connected = false;\n        this.notifyConnectionChange(false);\n      });\n\n      this.socket.on(\"connect_error\", (error) => {\n        if (!this.connected) {\n          reject(new Error(`Failed to connect to Volumio: ${error.message}`));\n        }\n      });\n\n      // Listen for state updates\n      this.socket.on(\"pushState\", (state: VolumioState) => {\n        this.notifyStateChange(state);\n      });\n    });\n  }\n\n  async disconnect(): Promise<void> {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = undefined;\n    }\n    this.connected = false;\n    this.notifyConnectionChange(false);\n  }\n\n  isConnected(): boolean {\n    return this.connected && this.socket?.connected === true;\n  }\n\n  async ping(): Promise<boolean> {\n    return this.isConnected();\n  }\n\n  onStateChange(callback: StateChangeCallback): void {\n    this.stateChangeCallbacks.push(callback);\n  }\n\n  onConnectionChange(callback: ConnectionStateCallback): void {\n    this.connectionChangeCallbacks.push(callback);\n  }\n\n  async getState(): Promise<VolumioState> {\n    return this.sendCommand<VolumioState>(\"getState\");\n  }\n\n  async getSystemInfo(): Promise<VolumioSystemInfo> {\n    return this.sendCommand<VolumioSystemInfo>(\"getSystemInfo\");\n  }\n\n  // ==================== Playback Control ====================\n\n  async play(n?: number): Promise<void> {\n    if (n !== undefined) {\n      await this.sendCommand(\"play\", { value: n });\n    } else {\n      await this.sendCommand(\"play\");\n    }\n  }\n\n  async pause(): Promise<void> {\n    await this.sendCommand(\"pause\");\n  }\n\n  async stop(): Promise<void> {\n    await this.sendCommand(\"stop\");\n  }\n\n  async toggle(): Promise<void> {\n    await this.sendCommand(\"toggle\");\n  }\n\n  async next(): Promise<void> {\n    await this.sendCommand(\"next\");\n  }\n\n  async previous(): Promise<void> {\n    await this.sendCommand(\"prev\");\n  }\n\n  async seek(position: number): Promise<void> {\n    await this.sendCommand(\"seek\", { position });\n  }\n\n  // ==================== Volume Control ====================\n\n  async setVolume(volume: number): Promise<void> {\n    if (volume < 0 || volume > 100) {\n      throw new Error(\"Volume must be between 0 and 100\");\n    }\n    await this.sendCommand(\"volume\", { value: volume });\n  }\n\n  async volumePlus(): Promise<void> {\n    await this.sendCommand(\"volume\", { value: \"plus\" });\n  }\n\n  async volumeMinus(): Promise<void> {\n    await this.sendCommand(\"volume\", { value: \"minus\" });\n  }\n\n  async mute(): Promise<void> {\n    await this.sendCommand(\"mute\");\n  }\n\n  async unmute(): Promise<void> {\n    await this.sendCommand(\"unmute\");\n  }\n\n  async toggleMute(): Promise<void> {\n    await this.sendCommand(\"mute\", { value: \"toggle\" });\n  }\n\n  // ==================== Queue Management ====================\n\n  async clearQueue(): Promise<void> {\n    await this.sendCommand(\"clearQueue\");\n  }\n\n  // ==================== Playback Options ====================\n\n  async setRandom(enabled: boolean): Promise<void> {\n    await this.sendCommand(\"random\", { value: enabled });\n  }\n\n  async setRepeat(enabled: boolean): Promise<void> {\n    await this.sendCommand(\"repeat\", { value: enabled });\n  }\n\n  async setRepeatSingle(enabled: boolean): Promise<void> {\n    await this.sendCommand(\"repeatSingle\", { value: enabled });\n  }\n\n  // ==================== Private Methods ====================\n\n  private async sendCommand<T = void>(\n    command: string,\n    data?: Record<string, unknown>,\n  ): Promise<T> {\n    return new Promise((resolve, reject) => {\n      if (!this.socket || !this.connected) {\n        reject(new Error(\"Not connected to Volumio\"));\n        return;\n      }\n\n      // For commands that return data (like getState)\n      if (command === \"getState\" || command === \"getSystemInfo\") {\n        this.socket.emit(command);\n        this.socket.once(command, (response: T) => {\n          resolve(response);\n        });\n      } else {\n        // For commands that don't return data\n        if (data) {\n          this.socket.emit(command, data);\n        } else {\n          this.socket.emit(command);\n        }\n        resolve(undefined as T);\n      }\n    });\n  }\n\n  private notifyStateChange(state: VolumioState): void {\n    for (const callback of this.stateChangeCallbacks) {\n      try {\n        callback(state);\n      } catch (_error) {\n        // Ignore callback errors\n      }\n    }\n  }\n\n  private notifyConnectionChange(connected: boolean): void {\n    for (const callback of this.connectionChangeCallbacks) {\n      try {\n        callback(connected);\n      } catch (_error) {\n        // Ignore callback errors\n      }\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
